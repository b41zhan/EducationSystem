<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ - –£—á–∏—Ç–µ–ª—å</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
            /* –£–ë–ò–†–ê–ï–ú –í–°–ï –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ï –í–´–°–û–¢–´ */
            height: auto;
            min-height: auto;
        }

        .header {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 22px;
        }

        .content {
            padding: 20px;
            /* –£–ë–ò–†–ê–ï–ú –§–ò–ö–°–ò–†–û–í–ê–ù–ù–£–Æ –í–´–°–û–¢–£ */
            height: auto;
            min-height: auto;
        }

        /* –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –û–°–¢–ê–í–õ–Ø–ï–ú –ö–ê–ö –ë–´–õ–û */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #333;
            font-size: 13px;
        }

        .form-control {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 13px;
        }

        .schedule-view {
            margin-top: 15px;
        }

        .day-schedule {
            margin-bottom: 20px;
        }

        .day-header {
            background: #667eea;
            color: white;
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 16px;
        }

        .lesson-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #e1e5e9;
            background: white;
        }

        .lesson-time {
            width: 100px;
            font-weight: bold;
            color: #333;
            font-size: 13px;
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-subject {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .lesson-details {
            color: #666;
            font-size: 12px;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day-column {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            /* –£–ë–ò–†–ê–ï–ú –§–ò–ö–°–ò–†–û–í–ê–ù–ù–£–Æ –í–´–°–û–¢–£ */
            height: auto;
            min-height: auto;
        }

        .day-title {
            background: #667eea;
            color: white;
            padding: 8px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
            border-radius: 8px 8px 0 0;
            line-height: 1.3;
        }

        .day-lessons {
            padding: 8px;
            /* –£–ë–ò–†–ê–ï–ú –§–ò–ö–°–ò–†–û–í–ê–ù–ù–£–Æ –í–´–°–û–¢–£ */
            height: auto;
            min-height: auto;
        }

        .week-lesson {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 8px;
            border-radius: 4px;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .week-lesson .time {
            font-weight: bold;
            font-size: 10px;
        }

        .week-lesson .subject {
            font-weight: bold;
            font-size: 11px;
        }

        .week-lesson .details {
            font-size: 10px;
            opacity: 0.9;
        }

        .view-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .toggle-btn {
            padding: 6px 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 12px;
        }

        .toggle-btn.active {
            background: #667eea;
            color: white;
        }

        /* –î–û–ë–ê–í–õ–Ø–ï–ú –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–£–Æ –í–´–°–û–¢–£ –î–õ–Ø –ü–†–û–ö–†–£–¢–ö–ò */
        .day-lessons {
            max-height: 400px;
            overflow-y: auto;
        }

        .day-lessons::-webkit-scrollbar {
            width: 4px;
        }

        .day-lessons::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }

        .day-lessons::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 2px;
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .week-grid {
                grid-template-columns: 1fr;
            }

            .container {
                margin: 0;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìÖ –ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
            <button class="btn btn-primary" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <div class="content">
        <div class="filters">
            <div class="form-group">
                <label>–ü–µ—Ä–∏–æ–¥:</label>
                <select id="periodSelect" class="form-control" onchange="loadSchedule()">
                    <option value="day">–ù–∞ –¥–µ–Ω—å</option>
                    <option value="week">–ù–∞ –Ω–µ–¥–µ–ª—é</option>
                </select>
            </div>

            <div class="form-group" id="dateGroup">
                <label>–î–∞—Ç–∞:</label>
                <input type="date" id="scheduleDate" class="form-control" onchange="loadSchedule()">
            </div>

            <div class="form-group" id="weekGroup" style="display: none;">
                <label>–ù–µ–¥–µ–ª—è —Å:</label>
                <input type="date" id="weekStartDate" class="form-control" onchange="loadSchedule()">
            </div>
        </div>

        <div class="view-toggle">
            <button class="toggle-btn active" onclick="switchView('day')">–î–µ–Ω—å</button>
            <button class="toggle-btn" onclick="switchView('week')">–ù–µ–¥–µ–ª—è</button>
        </div>

        <div id="schedule-content">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
        </div>
    </div>
</div>

<script>
    const token = localStorage.getItem('token');
    let currentView = 'day';

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if (!token) {
        window.location.href = '/login.html';
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('scheduleDate').value = new Date().toISOString().split('T')[0];

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
        const today = new Date();
        const monday = new Date(today);
        monday.setDate(today.getDate() - today.getDay() + (today.getDay() === 0 ? -6 : 1));
        document.getElementById('weekStartDate').value = monday.toISOString().split('T')[0];

        loadSchedule();
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞
    function switchView(view) {
        currentView = view;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        if (view === 'day') {
            document.getElementById('dateGroup').style.display = 'block';
            document.getElementById('weekGroup').style.display = 'none';
        } else {
            document.getElementById('dateGroup').style.display = 'none';
            document.getElementById('weekGroup').style.display = 'block';
        }

        loadSchedule();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    async function loadSchedule() {
        const scheduleContent = document.getElementById('schedule-content');
        scheduleContent.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>';

        try {
            let url;
            if (currentView === 'day') {
                const date = document.getElementById('scheduleDate').value;
                url = `/api/teacher/schedule/my/day?date=${date}`;
            } else {
                const startDate = document.getElementById('weekStartDate').value;
                url = `/api/teacher/schedule/my/week?startDate=${startDate}`;
            }

            const response = await fetch(url, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const lessons = await response.json();
                displaySchedule(lessons);
            } else {
                scheduleContent.innerHTML = '<div class="no-lessons">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</div>';
            }
        } catch (error) {
            scheduleContent.innerHTML = '<div class="no-lessons">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</div>';
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    function displaySchedule(lessons) {
        const scheduleContent = document.getElementById('schedule-content');

        if (lessons.length === 0) {
            scheduleContent.innerHTML = '<div class="no-lessons">–ù–µ—Ç —É—Ä–æ–∫–æ–≤ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>';
            return;
        }

        if (currentView === 'day') {
            displayDayView(lessons);
        } else {
            displayWeekView(lessons);
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–∞ "–î–µ–Ω—å"
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–∞ "–î–µ–Ω—å" - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
    function displayDayView(lessons) {
        const scheduleContent = document.getElementById('schedule-content');

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —É—Ä–æ–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
        lessons.sort((a, b) => a.startTime.localeCompare(b.startTime));

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞ (–≤—Å–µ —É—Ä–æ–∫–∏ –Ω–∞ –æ–¥–Ω—É –¥–∞—Ç—É)
        const lessonDate = lessons.length > 0 ? lessons[0].date : document.getElementById('scheduleDate').value;
        const dayOfWeek = lessons.length > 0 ? lessons[0].dayOfWeek : '';

        let html = `
        <div class="day-schedule">
            <div class="day-header">
                ${formatDate(lessonDate)} ${dayOfWeek ? `(${getRussianDayOfWeek(dayOfWeek)})` : ''}
            </div>
            <div class="lessons-list">
    `;

        if (lessons.length === 0) {
            html += '<div class="no-lessons">–ù–µ—Ç —É—Ä–æ–∫–æ–≤ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å</div>';
        } else {
            lessons.forEach(lesson => {
                html += `
                <div class="lesson-item">
                    <div class="lesson-time">${lesson.startTime} - ${lesson.endTime}</div>
                    <div class="lesson-info">
                        <div class="lesson-subject">${lesson.subjectName}</div>
                        <div class="lesson-details">
                            ${lesson.className ? `–ö–ª–∞—Å—Å: ${lesson.className}` : ''}
                            ${lesson.classroom ? `‚Ä¢ –ö–∞–±–∏–Ω–µ—Ç: ${lesson.classroom}` : ''}
                        </div>
                    </div>
                </div>
            `;
            });
        }

        html += `
            </div>
        </div>
    `;

        scheduleContent.innerHTML = html;
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–∞ "–ù–µ–¥–µ–ª—è"
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–∞ "–ù–µ–¥–µ–ª—è" - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
    function displayWeekView(lessons) {
        const scheduleContent = document.getElementById('schedule-content');
        const startDate = new Date(document.getElementById('weekStartDate').value);

        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —É—Ä–æ–∫–∏ –ø–æ –¥–∞—Ç–∞–º
        const lessonsByDate = {};
        lessons.forEach(lesson => {
            if (!lessonsByDate[lesson.date]) {
                lessonsByDate[lesson.date] = [];
            }
            lessonsByDate[lesson.date].push(lesson);
        });

        const dayNames = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'];

        let html = `
        <div class="week-schedule">
            <div class="week-grid">
    `;

        // –°–æ–∑–¥–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
        for (let i = 0; i < 7; i++) {
            const dayDate = new Date(startDate);
            dayDate.setDate(startDate.getDate() + i);
            const dateString = dayDate.toISOString().split('T')[0];

            html += `
            <div class="day-column">
                <div class="day-title">
                    ${dayNames[dayDate.getDay()]}<br>
                    <small>${formatDate(dateString)}</small>
                </div>
                <div class="day-lessons">
        `;

            const dayLessons = lessonsByDate[dateString] || [];

            if (dayLessons.length === 0) {
                html += '<div class="no-lessons">–ù–µ—Ç —É—Ä–æ–∫–æ–≤</div>';
            } else {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —É—Ä–æ–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
                dayLessons.sort((a, b) => a.startTime.localeCompare(b.startTime));

                dayLessons.forEach(lesson => {
                    html += `
                    <div class="week-lesson">
                        <div class="time">${lesson.startTime}-${lesson.endTime}</div>
                        <div class="subject">${lesson.subjectName}</div>
                        <div class="details">
                            ${lesson.className || ''} ${lesson.classroom ? `‚Ä¢ ${lesson.classroom}` : ''}
                        </div>
                    </div>
                `;
                });
            }

            html += `
                </div>
            </div>
        `;
        }

        html += `
            </div>
        </div>
    `;

        scheduleContent.innerHTML = html;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä—É—Å—Å–∫–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–Ω—è –Ω–µ–¥–µ–ª–∏
    function getRussianDayOfWeek(englishDay) {
        const days = {
            'MONDAY': '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
            'TUESDAY': '–í—Ç–æ—Ä–Ω–∏–∫',
            'WEDNESDAY': '–°—Ä–µ–¥–∞',
            'THURSDAY': '–ß–µ—Ç–≤–µ—Ä–≥',
            'FRIDAY': '–ü—è—Ç–Ω–∏—Ü–∞',
            'SATURDAY': '–°—É–±–±–æ—Ç–∞',
            'SUNDAY': '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'
        };
        return days[englishDay] || englishDay;
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ru-RU', {
            day: 'numeric',
            month: 'long',
            year: 'numeric'
        });
    }



    // –£—Ç–∏–ª–∏—Ç—ã
    function goBack() {
        window.history.back();
    }

    function logout() {
        localStorage.removeItem('token');
        window.location.href = '/login.html';
    }
</script>
</body>
</html>